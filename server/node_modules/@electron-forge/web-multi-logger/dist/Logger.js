"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Tab = void 0;
const node_path_1 = __importDefault(require("node:path"));
const express_1 = __importDefault(require("express"));
const express_ws_1 = __importDefault(require("express-ws"));
const Tab_1 = __importDefault(require("./Tab"));
exports.Tab = Tab_1.default;
class Logger {
    constructor(port = 9000) {
        this.port = port;
        this.app = (0, express_1.default)();
        this.tabs = [];
        this.server = null;
        this.registerRoutes();
    }
    registerRoutes() {
        this.ws = (0, express_ws_1.default)(this.app);
        this.app.get('/rest/tabs', (_req, res) => res.json(this.tabs));
        this.app.use('/xterm/addons/fit', express_1.default.static(node_path_1.default.dirname(require.resolve('xterm-addon-fit'))));
        this.app.use('/xterm/addons/search', express_1.default.static(node_path_1.default.dirname(require.resolve('xterm-addon-search'))));
        this.app.use('/xterm', express_1.default.static(node_path_1.default.resolve(require.resolve('xterm'), '../..')));
        this.app.use(express_1.default.static(node_path_1.default.resolve(__dirname, '..', 'static')));
        this.ws.app.ws('/sub', () => {
            // I assume this endpoint is just a no-op needed for some reason.
        });
    }
    /**
     * Creates a new tab with the given name, the name should be human readable
     * it will be used as the tab title in the front end.
     */
    createTab(name) {
        const tab = new Tab_1.default(name, this.ws);
        this.tabs.push(tab);
        return tab;
    }
    /**
     * Start the HTTP server hosting the web UI.
     *
     * @returns the port number
     */
    start() {
        return new Promise((resolve) => {
            this.server = this.app.listen(this.port, () => resolve(this.port));
        });
    }
    /**
     * Stop the HTTP server hosting the web UI
     */
    stop() {
        if (this.server)
            this.server.close();
    }
}
exports.default = Logger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0xvZ2dlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSwwREFBNkI7QUFFN0Isc0RBQThCO0FBQzlCLDREQUE2QjtBQUU3QixnREFBd0I7QUFFZixjQUZGLGFBQUcsQ0FFRTtBQUVaLE1BQXFCLE1BQU07SUFTekIsWUFBb0IsT0FBTyxJQUFJO1FBQVgsU0FBSSxHQUFKLElBQUksQ0FBTztRQVJ2QixRQUFHLEdBQUcsSUFBQSxpQkFBTyxHQUFFLENBQUM7UUFJaEIsU0FBSSxHQUFVLEVBQUUsQ0FBQztRQUVqQixXQUFNLEdBQXVCLElBQUksQ0FBQztRQUd4QyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVPLGNBQWM7UUFDcEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFBLG9CQUFHLEVBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFFL0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsaUJBQU8sQ0FBQyxNQUFNLENBQUMsbUJBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLHNCQUFzQixFQUFFLGlCQUFPLENBQUMsTUFBTSxDQUFDLG1CQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsaUJBQU8sQ0FBQyxNQUFNLENBQUMsbUJBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEYsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxNQUFNLENBQUMsbUJBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUU7WUFDMUIsaUVBQWlFO1FBQ25FLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVMsQ0FBQyxJQUFZO1FBQ3BCLE1BQU0sR0FBRyxHQUFHLElBQUksYUFBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILEtBQUs7UUFDSCxPQUFPLElBQUksT0FBTyxDQUFTLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDckMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNyRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUk7UUFDRixJQUFJLElBQUksQ0FBQyxNQUFNO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN2QyxDQUFDO0NBQ0Y7QUFyREQseUJBcURDIn0=